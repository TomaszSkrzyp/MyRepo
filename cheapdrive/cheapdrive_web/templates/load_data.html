
<!DOCTYPE html>
<html>
<head>
    <title>Load Data</title>
</head>
<body>
    <h1>Type in your data</h1>
    <form method="POST" id="form">
        {% csrf_token %}
        <label for="starting_address">Start:</label>
        <input type="text" id="starting_address" name="starting_address" required><br><br>

        <label for="finishing_address">Destination:</label>
        <input type="text" id="finishing_address" name="finishing_address" required><br><br>

        <label for="tank_size">Tank size (litres):</label>
        <input type="number" id="tank_size" name="tank_size" step="0.1" required><br><br>

        <label for="fuel_type">Fuel Type:</label>
        <select id="fuel_type" name="fuel_type" required>

            <option value="P">Pb95</option>
            <option value="D">Diesel</option>
        </select><br><br>
        <div>
            <label for="cur_fuel">Current Fuel:</label><br>
            <label for="cur_fuel_liters">
                Liters:
                <input type="radio" id="cur_fuel_liters" name="cur_fuel_input_type" value=0 checked>
                <input type="number" id="cur_fuel" name="cur_fuel" step="0.1" required><br><br>
            </label>
            <label for="cur_fuel_percentage_radio">
                Percentage of Tank:
                <input type="radio" id="cur_fuel_percentage_radio" name="cur_fuel_input_type" value=1>
                <input type="number" id="cur_fuel_percentage" name="cur_fuel_percentage" step="1" min="0" max="100" disabled>
            </label><br><br>
        </div>

        <label for="fuel_consumption_per_100km">Fuel Consumption (liters/100km):</label>
        <input type="number" id="fuel_consumption_per_100km" name="fuel_consumption_per_100km" step="0.1" required><br><br>

        <label for="price_of_fuel">Price for currently owned fuel (Zloty per litre):</label>
        <input type="number" id="price_of_fuel" name="price_of_fuel" step="0.01" required><br><br>
        <select id="currency" name="currency" required>
            <option value="USD">USD</option>
            <option value="PLN">PLN</option>
            <option value="EUR">EUR</option>
        </select>
        <button type="button" onclick="submitform();">Send</button>

    </form>

    <div class="messages">
        {% if messages %}
        <ul>
            {% for message in messages %}
            <li class="{% if message.tags %} {{ message.tags }}{% endif %}">{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
    <script>
    function validateAddress(address) {
            // Basic address validation (can be more complex)
            if (!address.includes(" ")) {
                alert("Address should include at least one space and one comma.");
                return false;
            }
            return true;
        }

        function validateFuelAmount(fuel_amount) {
            // Check if the input is a valid number
            if (isNaN(parseFloat(fuel_amount)) || !isFinite(fuel_amount)) {
                alert("Amount of Fuel must be a valid number.");
                return false;
            }

            // Check if the amount of fuel is a positive number
            if (parseFloat(fuel_amount) <= 0) {
                alert("Amount of Fuel must be a positive number.");
                return false;
            }
            return true;
        }
        function confirm_no_fuel_overflow(cur_fuel, tank_size) {
            if (parseFloat(cur_fuel) > parseFloat(tank_size)) {
                alert("Fuel amount in a vehicle cant be higher than it's tank size");
                return false;
            }
            return true;
        }
        function validatePrice(price) {
            // Check if the input is a valid number
            if (isNaN(parseFloat(price)) || !isFinite(price)) {
                alert("Price must be a valid number.");
                return false;
            }

            // Check if the price is a non-negative number
            if (parseFloat(price) < 0) {
                alert("Price must be a non-negative number.");
                return false;
            }
            return true;
        }</script>

    <script>
        const cur_fuel_liters_input = document.getElementById('cur_fuel');
        const cur_fuel_percentage_input = document.getElementById('cur_fuel_percentage');
        const fuel_input_type_radios = document.querySelectorAll('input[name="cur_fuel_input_type"]');

        function submitform() {
            let form = document.getElementById('form');
            let starting_address = document.getElementById('starting_address').value;
            let finishing_address = document.getElementById('finishing_address').value;

            let tank_size = document.getElementById('tank_size').value;
            let fuel_type = document.getElementById('fuel_type').value;

            let cur_fuel_input_type = document.querySelector('input[name="cur_fuel_input_type"]:checked').value;
            let cur_fuel = document.getElementById('cur_fuel').value;

            let cur_fuel_percentage = document.getElementById('cur_fuel_percentage').value;
            let fuel_consumption_per100km = document.getElementById('fuel_consumption_per_100km').value;
            let price_of_fuel = document.getElementById('price_of_fuel').value;
            let currency = document.getElementById('currency').value;

            if (!validateAddress(starting_address)) {

                return; // Stop if validation fails
            }
            if (!validateAddress(finishing_address)) {
                return;
            }
            console.log(0)
            if (cur_fuel_input_type != 1 && cur_fuel_input_type != 0) {
                return;
            }


            console.log(1)
            if (!validateFuelAmount(tank_size)) {

                return;
            }

            console.log(cur_fuel)
            if (cur_fuel_input_type == 0) {
                if (!validateFuelAmount(cur_fuel)) {
                    console.log(cur_fuel);
                    return;

                }
                else {
                    console.log("basdjk")
                    if (!confirm_no_fuel_overflow(cur_fuel, tank_size)) {
                        console.log("tttttjk")
                        return;
                    }

                }
            }
            else {
                if (!validateFuelAmount(cur_fuel_percentage)) {
                    if (!confirm_no_fuel_overflow(cur_fuel_percentage * parseFloat(tank_size) / 100, tank_size)) {
                        return;
                    }
                    return;
                }
            }

            console.log(3)
            if (!validateFuelAmount(fuel_consumption_per100km)) {
                return;
            }

            console.log(4)
            if (!validatePrice(price_of_fuel)) {
                return;
            }
            form.submit();

        }

        fuel_input_type_radios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                const selectedValue = event.target.value;
                if (selectedValue == 0) {
                    cur_fuel_liters_input.disabled = false;
                    cur_fuel_percentage_input.disabled = true;
                    cur_fuel_percentage_input.value = '';
                } else if (selectedValue == 1) {
                    cur_fuel_liters_input.disabled = true;
                    cur_fuel_percentage_input.disabled = false;
                    cur_fuel_liters_input.value = '';
                }
            });
        });
    </script>
</body>
</html>
